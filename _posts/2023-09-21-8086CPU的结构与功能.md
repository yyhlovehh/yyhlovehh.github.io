# 微机原理第二章8086CPU的结构与功能

## 1.微处理器的外部结构

**微处理器的外部结构表现为数量有限的输入输出引脚。**输入输出引脚构成了微处理器级总线，通过数据总线、地址总线、控制总线与外部IO设备以及存储器进行通信。

8086CPU是一个16位的微处理器，即CPU内部的寄存器为16位，一共含有40个引脚，采用双列直插式封装。

A表示地址引脚，D表示数据引脚，AD表示地址/数据引脚，引脚复用。

- A0~A19为存储器地址线，有2^20=1M个存储单元,如果每个存储单元为一个字节，则存储空间为1MB或1M字节。
- A0~A16也为IO地址线，有2^16个IO地址。**通过M/IO引脚来分辨是存储器地址码还是IO地址码，即存储器地址空间和IO地址空间是独立的。**
- CPU编址有独立编制和统一编制之分。独立编制即地址码可以重复，存储器地址空间和IO地址空间是独立的。

任何一个IO设备都要通过接口电路与CPU进行通信。

端口就是IO端口寄存器。有状态寄存器，用于存储设备当前的状态，CPU读取寄存器的值来获取设备当前的状态；也有数据端口寄存器，用于数据传输；也有控制寄存器，用于告诉设备数据是否有效。**端口寄存器的地址由IO地址线给出。**

### 1.1寻址：[]相当于指针的*号

8086CPU采用独立编制模式，即存储器地址空间与IO地址空间是分开的，对存储器传输数据采用语句MOV，而对IO传输数据采用IN/OUT。

- 直接寻址：  

`MOV  AL ， 20H；`

`MOV  [2000H]， AL；`

- 间接寻址：

`MOV  AL ， 20H；`

`MOV  BL ， 2000H；`

`MOV  [BL]， AL；`

- IO设备：

`MOV AL，20H;`

`MOV DX,2000H；`

`OUT [DX],AL`

## 2.微处理器的内部结构

- ALU：算术逻辑运算单元
- 寄存器：分为数据寄存器和地址寄存器。数据寄存器，用于暂存数据，提高数据传输速度。地址寄存器，可以存储地址和数据。
- 控制器：中央指挥机关。PC:程序计数器，一般为16位。IR:指令寄存器，一般位8位。ID:指令译码器，一般为8位。

控制逻辑部件；堆栈指针SP;微处理器状态字PSW。

- IO控制逻辑

**CPU的控制过程：太棒了！！**

程序代码编译后变为机器语言（2进制），放在存储器中。控制器的程序计数器通过地址总线传输地址，同时CPU发出读命令，存储器的数据通过数据总线传到CPU控制器中的指令寄存器中，指令译码器对指令寄存器的指令译码，通过控制逻辑部件执行指令。之后，程序计数器增加到相应的地址，重新取指令。一直取指令，执行指令，重复如此，执行效率不高。**因此有了堆栈。**

由于指令和数据很多，CPU内部的寄存器不够用。可以采用堆栈，把之前寄存器中的数据push进入堆栈中，提高CPU的效率。

### 2.1堆栈

由先进后出原则组织的一段存储器区域，区域大小按需求来定。

压数据：push;取数据：pop。

8086堆栈必须按字操作。

### 2.28086CPU内部结构

- BIU:总线接口单元。CS:code segment代码段；ES:附加段;SS:堆栈段;DS：数据段；IP:程序计数器PC。
- EU:执行单元。

**8086的地址线有20条，但是寄存器为16位，采用间接寻址时，16位的寄存器无法寻址完1M地址空间，因此Intel公司将地址空间分为几段，每段最多64K地址空间，对应2^16。当要寻址时，首先看段地址（16位），然后根据程序计数器PC（16位）存储的指令地址进行寻址。**

- 指令队列寄存器：6个字节。

BIU：主要负责从外部存储器中取指令，并将取回的指令放入指令队列中。

EU:主要负责从指令队列中获取指令，遵循先进先出原则，并进行译码加以执行。

此时取指令和执行指令并行，提高效率。

## 3.寄存器REG

8086CPU一共有14个16位寄存器。

#### **通用寄存器8个：**

**包含4个数据寄存器**，AX、BX、CX、DX。 **除了可以暂时存储数据**，还有特殊功能如下：

1. AX：累加器
2. BX：基址寄存器
3. CX：计数器
4. DX：数据寄存器，但在IO指令中，常用于表示端口地址

**包含4个地址寄存器，SP、BP、SI、DI。**

**2个16位地址指针寄存器**：

1. SP:堆栈指针寄存器。用于保存堆栈段的段内偏移地址，段地址由段寄存器SS提供。
2. BP:地址指针寄存器。可以指定段内偏移地址，**但将BP用作地址寄存器时，其默认的段地址为SS**。而由BX指定的段内偏移地址，默认段地址为数据段。如果要修改段地址，需要加段超越前缀。

**2个16位变址寄存器：**变的概念针对字符串传输。

1. SI:源变址REG。
2. DI:目的变址REG。

#### 段寄存器4个：

1. 数据段寄存器DS
2. 代码段寄存器CS：注意CS不能做目的。
3. 附加数据段寄存器ES
4. 堆栈段寄存器SS

#### 控制寄存器2个：

1. 指令指针寄存器IP：指令的段地址在CS中，偏移地址由IP存储，用于取指令，等效于一般八位处理器中的程序计数器PC。也不能做目的。
2. 处理器状态字寄存器PSW：6个状态标志位，3个控制标志。

## 4.微处理器的存储器和I/O组织

地址线A0~A19,一共20条，同时存储单元为1个字节，因此可寻址1M字节地址空间。同时低16条地址线也给IO编址，IO地址空间为2^16个字节，为64K字节IO地址空间。**而在PC机中，只用了A0~A9用于分配IO地址，共1K字节。**前512K给主板IO,后512K给插件IO（用户找）。

### 4.1数据存放格式

字节型数据：1个字节数据占用一个存储单元。定义：伪指令DB。

字型数据：字单元的地址为奇数，为未对准。偶数为对准。对准的读写速度快。定义：伪指令DW。

双字型数据：定义：伪指令DD。

### 4.2存储器的分段与物理地址的形成

- 存储器为什么要分段？

由于20根地址线可寻址1MB，但是用于寻址的地址寄存器为16位，为64KB。为了寻址完，把1MB分为了许多段。

- 怎么分段？

每个逻辑段最大为64KB，每个逻辑段的起始地址必须能被16整除。