## 课题

罗技方向盘竟然可以有真实的力反馈？如何实现的？

## 1.路感是什么？

​	路感是指汽车在行驶中驾驶人对路面的感觉，或者说是通过轮胎、悬架、转向机构、座椅等传递给驾驶人的路面信息，是汽车对路面信息的反馈。**路感不清，当然对行车不利；但如果路感太清，也会影响行车的舒适性。**如果压过一个硬币都能让驾驶人感觉到，那会非常不舒适，因此路感也要恰到好处。

　路感的反馈途径纵然有多种，但主要是通过转向盘和座椅向驾驶人传递。因此，转向机构的设计和制造，基本决定路感的清晰度。普通轿车上一般采用齿轮齿条式转向，这样的结构可以保证路感传递较为直接，利于驾驶人掌握和了解路面情况。

　轮胎的性能对路感传递的影响也很大。一般来讲，扁平比较大的轮胎，即比较扁的宽轮胎，它的路感较为清晰，毕竟它与路面的"距离"更近，更能将路面情况通过较扁平的轮胎传递给驾驶人。

　悬架的作用除了支撑车身外，其主要作用就是"过滤"路感，将那些让人不太舒服的路感"过滤"掉，只留下驾驶人必须要了解的"路感"。因此，悬架较硬的车型，其路感也会较清晰，它保留的路感也更丰富；反之，悬架较软的车型，它过滤掉的路感也较多，虽然舒适性提高了，但往往会造成路感不是非常清晰。

　路感是否清晰，对安全行车和更好地驾驭、操控车辆非常重要，它可以使你真切地了解汽车所驶过的路面情况，以便进行针对性的操控。否则，**如果路面信息不清，驾驶人对正在行驶的道路条件不清楚，好比是盲人骑瞎马，对行车安全和提高行车速度不利。**



**总结：路感就是驾驶员对路面的感觉、感受。如果路感太小，驾驶员对路面信息获取不充足，不利于行车安全，比如加减速；如果路感太大，舒适性会下降，因此根据汽车的定型以及需求设计合适的路感。**

## 2.人机共驾

## 3.驾驶员肌电信息疲劳衰退特性（创新点）

路感的产生考虑到驾驶员肌电信息疲劳衰退特性？

### 3.1期望目标

**在相同路面行驶时，我们期望驾驶员的路感是一致的。**然而由于驾驶疲劳的原因，现存的路感模拟（**相同路面产生相同方向盘回正力矩**）并不能够满足目标，路感会随着肌肉疲劳而增大，从而给驾驶员一种相同路面不同路感的感觉。	

### 3.2表面肌电信号

1） 表面肌电信号是一种非平稳的微电信号，其幅值在 0~1.5mv，**有用信号频率**位于 0~500HZ，主要能量集中在 20~150HZ，因此在采集到sEMG之后会进行预处理。

2） 表面肌电信号一般比肢体运动超前 30~150ms产生，可以进行运动提前判断，因此可以通过sEMG预测接下来的动作，即出现了**肌电预测模型。**

肌电图与肌肉收缩之间有着密切的关系，一般情况下，当肌肉轻度收缩时，肌电信号相对较弱，频率也低：当肌肉强力收缩时，肌电信号较强，频率高。

在常见的肌电分析中，如**肌电信号的均方根，中值以及平均功率频率等可以用于评估肌肉疲劳程度**。特别是**表面肌电信号的均方根振幅，由于疲劳肌肉需要激活更多的肌纤维来维持所需要的力，因此疲劳肌肉的表面肌电信号均方根振幅明显高于非疲劳肌肉。**与此相反的是，**肌肉在收缩时，疲劳肌肉的肌电信号的中值频率和平均功率频率明显低于非疲劳肌肉肌电信号。**这些指标在各种肌肉疲劳评价中得到广泛运用。如在一项模拟上肢重复性任务中，研究人员对肩膀肌肉的表面肌电活动进行观察发现，与任务相关的肌肉疲劳之后，其肌电图活动的中值功率频率显著降低（如下图所示），均方根振幅显著增加。

#### 3.2.1常用分析指标

表面肌电的分析指标分为时域和频域指标。

时域指标包括肌电积分值(IEMG)、平均肌电值(AEMG)、均方根值(RMS)及协同收缩率，时域指标反映局部肌肉运动单位动员或募集程度，**主要用于评判肌肉收缩程度与特征的情况**；**频域指标包括平均功率频率(MPF)、中位频率(MF)，频域指标反映局部肌肉疲劳程度，主要用于判断肌肉的疲劳情况。**

**目标是不是可以变为？**随着局部肌肉疲劳，方向盘回正力矩下降。

- 肌电积分值(IEMG)是一定时间内肌肉中参与活动的运动单位的放电总量，时间不变的前提下，反映运动单位数量的多少和每个运动单位的放电大小，随着负荷持续时间呈线性规律递减。
- 平均肌电值(AEMG)是反映信号振幅变化的特征性指标，是一段时间内瞬间肌电图振幅的平均，反映肌肉活动时运动单位激活的数量、参与活动的运动单位类型以及同步化程度。
- 均方根值(RMS)是一段时间内瞬间肌电图平方平均的平方根，是放电的有效值，与AEMG意义基本相同。
- 平均功率频率(MPF)是反映信号频率特征的生物物理指标，其高低与外周运动单位动作电位的传导速度、参与 活动的运动单位类型以及同步化程度有关，是临床常用判断肌肉活动时的疲劳度的常用指标。
- 中位频率(MF)是骨骼肌收缩过程中肌纤维放电频率的中间值，与肌肉组织中快和慢肌纤维组成的比例有关，快肌纤维兴奋出现高频放电，慢肌纤维兴奋则以低频放电为主。

#### 3.2.2应用

**利用表面肌电评定神经和肌肉的机能状态**

肌肉疲劳时期肌电活动也会发生变化，因此可以用肌电评定骨骼肌的机能状态。

1.肌肉工作过程中肌电幅值的变化

在肌肉等长收缩至疲劳的研究过程中发现，在一定的范围内，肌电幅值随着肌肉疲劳程度的加深而增加。以最大强度以下的肌力进行等长收缩时，肌电的幅值随着时间的延长而增加;而用最大肌力进行等长收缩时，随着肌力的下降肌电的幅值也逐渐下降。

2.肌肉工作过程中肌电频谱变化

研究表明，在肌肉工作过程中，肌电的频率特性可随着肌肉的机能状态的改变而发生变化。反应肌电的频率特性的指标有平均功率频率(MPF)  和中心频率(MF)。在研究肌肉持续工作至疲劳过程中发现，**随着疲劳程度的加深，肌电的频谱左移，即平均功率频率降低**。肌肉工作的负荷强度越大，疲劳的程度越大，平均功率频率和中心频率的减小越明显。

**利用表面肌电评价肌力**

当肌肉以不同的负荷进行收缩时，其积分肌电同肌力成正比关系，即肌肉产生的张力越大积分肌电越大。

### 3.3肌肉激活度（可测）路感量化指标

#### 	   0代表完全放松，1代表使劲全力。则期望目标变为：希望相同路面的肌肉激活度是一样的。

实时激活度=（实时均方根值）/一片肌肉最大肌电电压值

问题：一片肌肉的最大力是否会随着疲劳而下降？

问题：已知力越大，肌电信号电压越高。

**当方向盘回正力矩相同时，驾驶员疲劳之后，该处肌肉所能产生的力变小，则肌电信号会下降？**

### 3.4机械特征辨识

驾驶员开车不可能一直戴着肌电信号采集器，因此希望肌肉激活度与驾驶工况关联。

![3](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312081806310.png)

Th:净输入力矩=手臂给方向盘的输入力矩-方向盘回正力矩（路感）。

方向盘转角可测、净输入力矩可测，可以通过递归最小二乘法得出转动惯量Ih、阻尼Dh、刚度Kh。

通过神经网络以转动惯量Ih、阻尼Dh、刚度Kh为输入，肌肉激活度为输入训练。

问题：？程序除刚度不收敛？



**转向盘数学模型：**

用于转向盘状态的控制。

![10](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312141438186.png)

对于方向盘：**状态方程**

方向盘的状态=输入力矩（驾驶员手臂输入力矩-方向盘摩擦力矩-**路感电机传递回正力矩**）

已知Jsw、Bsw、Ks、方向盘转角、角速度、角加速度、回正力矩，**就可以求出驾驶员手臂输入力矩。驾驶员手臂力=手臂输入力矩/方向盘半径。**

**而驾驶员手臂力与RMS_EMG成正相关。这样就将路感电机期望回正力矩与RMS_EMG联系起来**

思路：

比如所需**RMS_EMG=f(手臂力，t)=a*手臂力+bt+c**，当方向盘转角固定时，那么我们希望驾驶员驾驶过程中RMS_EMG保持一定或者更加缓慢的上升，即驾驶员的输入手臂力大小一定，路感电机期望回正力矩下降。



1.首先用转矩传感器、肌电信号采集器采集数据，记录一系列RMS_EMG和驾驶员手臂力矩，拟合该驾驶员的曲线；

2.其次用线控转向的路感力生成模型，输入位车速、方向盘转角，输出期望路感力求出不同车速、转角下的路感力;

3.将所求路感力代入方向盘数学模型中，**忽略阻尼与惯量，估出驾驶员手臂力矩大小**；结合驾驶时间估计出RMS_EMG值。

4.根据RMS_EMG值控制回正力矩下降。路感力=当前计算路感力-k*RMS_EMG。**路感力=当前计算路感力-bt**

5.路感力输入转向盘数学模型中，驾驶员手臂力距下降=路感力下降=k*RMS_EMG；

6.用手臂力距和时间估计RMS_EMG。

**目标：最高抵消时间影响的RMS_EMG值，即a*(手臂力减少量)=bt**



实验：

测正常不发力时的肌电信号：方向盘不被人控制  **=c是否为常值呢？** 

发力时的肌电信号：人打方向盘。

- 开始前，打开转矩传感器上位机、肌电信号采集器，不打方向盘测一段时间，准备好后，方向盘打一定角度持续半小时，转矩突变点和肌电信号突变点对齐，测出肌电信号和转矩。

- 进行拟合，得到**RMS_EMG=f(手臂力，t)=a*手臂力+bt手臂力+c**。关联：神经网络：RMG_EMG、手臂力、时间段 训练

- 还可得到未控制前的RMS_EMG曲线；

- 根据实测手臂力-路感力大小估算出刚度Ks。

- 控制路感力每隔一段时间T减小，a*减小量=bT。

  a*减小量=b*减小量*T=> a=bT。

- 得出新曲线RMS_EMG-t。

**电机数学模型：**

用于电机状态的控制。

![11](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312141452882.png)

### 3.5数据处理

降噪与滤波？

### 3.6递归最小二乘法求解

- 特点：数据A、b是随着新数据的获取不断增大的。
- 考虑遗忘因子：若最优x本身随时间变化，需要给新数据赋较大权重，旧数据赋较小权重。**遗忘因子设为0，不考虑以前的数据？为什么要考虑以前的数据**

![4](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090028121.png)

![5](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090029380.png)

![6](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090029013.png)

![7](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090030797.png)

![8](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090030069.png)

![9](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090030338.png)

![10](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090031412.png)

![11](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090031128.png)

![12](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090031830.png)

![13](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312090031163.png)

### 3.6硬件可测

转角传感器：测出净输入力矩大小。

肌电采集器：测出肌电电压在行车过程中的变化。

## 4.线控转向（Steering-By-Wire）的路感怎么产生？

答：主控制器接收车轮转角传感器所采集到的车轮信息，结合车辆的状态信息，向回正力矩电机发送相应的力矩指令。回正力矩电机模拟出路面反馈的信息，从而向驾驶员提供实时的路感。

### 4.1线控转向系统

汽车转向系统决定了汽车的横向运动，传统的转向系统是机械系统：驾驶员操纵方向盘，通过转向器和拉杆,将转向意图传递到转向车轮，从而实现转向运动。

早期的机械液压助力转向系统、当下普及的电液助力转向系统和电动助力转向系统等，都属于基于机械部件的转向系统。这些机械系统在进化的过程中，优化了转向系统的力传递特性，为转向控制提供了助力，提升了汽车的操纵稳定性和平顺性。但是，受限于机械结构，**它们无法改变转向系统的角传递特性，即汽车的转向特性，因此难以实现自动驾驶所要求的主动控制。**

**线控转向系统（Steering-By-Wire），取消了方向盘和转向车轮之间的机械连接部件，彻底摆脱了机械固件的限制，完全由电能来实现转向。**线控转向系统不仅具有传统机械转向系统的所有优点，**更可以实现机械系统难以做到的，角传递特性的优化**。在线控转向系统中，驾驶员的操纵动作通过传感器变成电信号，信号经分析处理后，通过导线直接传递到执行机构。由于不受机械结构的限制，可以实现理论上的任意转向意图，因此线控转向系统被称为目前最先进的转向系统。

### 4.2线控转向系统结构

线控转向系统主要由方向盘模块、主控制器、执行模块、故障处理系统，电源等部分组成。其中方向盘模块、主控制器、执行模块是线控转向的3个主要部分，其他模块属于辅助部分。

![1](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312081233145.png)

- 方向盘模块是**转向意图的输入模块**，包括方向盘、转角传感器、扭矩传感器、回正力矩电机以及相关的附件等。方向盘模块通过测量方向盘的转角和转矩，将驾驶员的转向意图，转换成数字信号，并传递给主控制器；**同时，方向盘模块接收主控制器反馈的力矩信号，产生方向盘的回正力矩，为驾驶员提供对应的路感。**

- 主控制器，即ECU，是线控转向的核心，相当于大脑，它决定了线控转向的控制效果。它的主要作用是分析和处理各路信号，判断转向意图和汽车的运动状态，并输出相应的控制指令。主控制器一方面对采集到的信号进行分析处理，向转向执行电机和回正力矩电机发送指令，确保两台电机协同工作，从而**实现车辆的转向运动和路感的模拟**。另一方面，主控制器保持对驾驶员的操作和车辆的状态进行实时监控，实现智能化的控制。

当系统检测到转向意图不合理、系统指令出现错误或者汽车出现不稳定的状态时，主控制器能够及时屏蔽错误的指令，并以合理的方式自动控制车辆，使汽车尽快恢复到稳定的状态。另外，当线控转向系统出现故障的时候，主控制器能够及时的采取措施，进行补救，保证行车的安全和稳定。

- 转向执行模块的作用是**实现和执行驾驶员的转向意图**，它由转向执行电机、转向电机控制器、车轮转向组件以及车轮转角传感器组成。执行模块接受主控制器的指令，通过转向电机及其控制器，控制转向轮的转动，实现转向。

另外，车轮转角传感器将测得的车轮位置信号同步反馈给主控制器，用于计算分析和闭环控制。

- 故障处理系统也是线控转向系统的重要模块，它包含一系列的监控与应对措施的程序。当线控转向系统出现故障时，故障处理系统按照设定好的程序，采取对应的处理措施，以避免或减轻该故障带来的危害，最大程度地保证汽车的行驶安全。

- 此外，电源作为供电设施，也是线控转向系统中不可或缺的一部分。

### 4.3线控转向的原理

基于线控转向系统的结构，我们可以很容易地分析线控转向的工作原理。

当方向盘转动时，方向盘的转角传感器和扭矩传感器分别将测量到的转角与扭矩信息，转变成电信号，传输给主控制器；同时，主控制器接收相应传感器采集到的车轮运动状态信号，如车速、纵向加速度、横摆角速度等。基于上述信号，主控制器对方向盘的转角和扭矩信号进行处理，并向转向执行电机发送控制指令，实现合理的转向。

**另一方面，主控制器接收车轮转角传感器所采集到的车轮信息，结合车辆的状态信息，向回正力矩电机发送相应的力矩指令。回正力矩电机模拟出路面反馈的信息，从而向驾驶员提供实时的路感。**

当主控制器出现错误或故障时，故障处理模块会根据故障的形式与等级，作出相应的处理，确保驾驶员能够发现故障，并保持安全行驶。

![2](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312081240605.png)

### 4.4线控转向的优势与难点

从线控转向系统的结构分析中，可以看出：方向盘和转向车轮之间的机械连接不复存在，取而代之的是电线电缆之间的信号连接。这种基于纯电信号控制的转向系统，具有一系列传统机械转向系统所不具备的优势。

**第一，更安全。**

由于取消了转向柱等机械结构，因此可以完全避免碰撞事故中，转向柱对驾驶员的伤害。

**第二，更舒适。**

智能化的ECU能够根据汽车的行驶状态，实时判断驾驶员的操作是否合理，并做出相应的调整。当汽车处于非平稳的工况时，线控转向系统可以自动地对汽车进行稳定性控制。对于车内人员来说，会感到更加平稳舒适。

消除机械连接的同时，驾驶员的腿部活动空间得以增大。同时，地面的横纵向不平顺，不会直接传递到驾驶员的手上，路感信息由回正力矩电机模拟生成，会过滤无用的信息，只向驾驶员提供有用的信息，从而改善驾驶的舒适性。

另外，线控转向系统有一个重要的特点：传动比可变，且可以任意设置。因此，可以让汽车按最理想的转向特性行驶。并且，线控转向系统可以对随车速变化的参数进行补偿，使汽车的转向特性不再随车速的变化而变化，从而减轻驾驶员的负担。

**第三，更经济。**

传统的转向系统存在大量机械结构，取消这些机械结构，可以显著降低汽车的重量，并因此减少耗油量或耗电量。同时，取消这些机械连接，也降低了汽车的零件生产成本。

**第四，更智能。**

线控转向系统是整车的一部分，线控转向系统的控制器，可以和汽车的其他控制器交换并共享数据。由此，转向控制器可以获取汽车的整体运动状态，并通过算法优化，综合提升车辆的操纵稳定性。





然而，我们也必须意识到，线控转向仍然存在技术上的难点。

**首先，线控转向需要保证足够的可靠性和鲁棒性。**由于取消了机械结构，所有的控制都通过电信号实现，因此必须保证复杂的程序运算不会出错，否则将导致严重的驾驶事故。

目前的做法是一方面提升计算程序的性能，另一方面提供冗余备份，使得当

主系统发生故障时，仍有另一套冗余系统可以工作，保持正常行驶。但是，冗余系统的设计、布局，以及两套系统之间的交互，存在一定的困难。

**其次，线控转向系统需要实时地模拟路面的路感，以便驾驶员的合理驾驶。**这也对计算程序的性能提出了较高的要求。当然，如果是L5级的自动驾驶，完全取消方向盘，则没有这个问题，但是L5的实现还很遥远。

**此外，线控转向系统对转向电机的功率要求高**，相应的，转向电机的成本也将增加。

## 5.线控转向的路感控制策略

线控转向的路感反馈是通过动力学模型计算和参数拟合两种方式模拟生成转向阻力矩。

- 动力学模型计算方法是通过分析传统转向系统的路感产生原理，利用轮胎侧向力即轮胎拖矩等参数，建立动力学模型，计算得到路感反馈力矩；缺点:非线性线性化。
- 参数拟合选取方向盘转角、转角速度、车速等车辆状态参数，进行函数拟合，获得路感；
- 标定法。

参数拟合需要大量的实验数据以及车辆参数， 不易获取， 针对以上问题， 选取动**力学模型计算的方式生成目标回正力矩， 使用粒子群算法优化 PID 控制器， 控制路感电机， 模拟产生转向阻力矩， 使驾驶员获得“路感”。**

### 路感电机期望输出力矩计算（规划）：

主要参考文献：《线控转向汽车路感控制策略  》谢立刚。

![8](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312131607188.png)

**动力学模型计算方法求出转向阻力矩。输入转角、车速等，输出为路感电机回正力矩。**

**SBW的主要功能包括路感反馈控制和转向执行的角度控制。**

转向盘总成根据转角转矩传感器测量的转向盘转角信号传递给SBW控制器，控制器根据车速、道路信息和转向盘实时状态产生相应的路感算法驱动路感电机，产生合适的路感信息协助驾驶员操控车辆；

转向执行总成根据齿条位移传感器将换算得到的前轮转角反馈给SBW 控制器，控制器根据当前驾驶员的转向意图得出相应的前轮转角控制量，完成前轮转角的角度伺服控制，实现准确地前轮跟踪控制功能。

### CarSim+魔术公式拟合：

根据CarSim中数据输入侧偏角，即可求得回正力矩。

### 加EPS路感电机期望输出力矩：





### 路感电机控制PID:

![7](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312131548435.png)

### 知识补充

1.主销拖矩

主销拖距指的是**主销轴线**（麦弗逊悬架一般为减震器上安装面中心点到下边摆臂球心点）**到地面延长线**与**轮胎接地点中心位置的距离**。拖距与主销后倾相关，拖距越大，对转向不足有利，转向回正也会好一点，对整车直行性有好处！

2.轮胎拖矩

轮胎发生侧偏现象时所产生的**回正力矩的力臂**。

![9](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202312132109698.png)

问题：

1、采集的数据是12位吗？

3330是发大增益吗？如何获得？是电位计控制的吗？

2、路感电机的控制策略？是用Simlink吗？

3、设备的方向盘回正力矩是固定的吗？即只取决于角度，不取决于虚拟路面？

4、如何通过转距传感器获得转角？