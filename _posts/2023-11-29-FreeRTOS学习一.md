# FreeRTOS学习一

## 1、任务创建

**常用动态创建任务，比较方便。**

![4](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291725014.png)

![1](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291333303.png)

![2](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291335681.png)

![3](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291338186.png)

![5](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291909007.png)



**任务调度本质上是使用中断进行的，而使用临界区保护，就是保护那些不想被打断的程序段。**

## 2、任务挂起和恢复

![2_1](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291914905.png)

![2_2](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291915188.png)

![2_3](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291917147.png)

![2_4](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311291918002.png)

pdTRUE:恢复的任务优先级大于当前正在执行的任务；

pdFALSE:不需要进行任务切换。

**中断优先级范围：5~15。中断优先级越小越高。**

## 3、中断管理系统

![3_1](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292206331.png)

![3_2](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292211073.png)

![3_3](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292212284.png)

![3_4](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292214141.png)

![3_5](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292215657.png)

PendSV:用于任务切换、调度；

SysTick

![3_6](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292220672.png)

![3_7](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292222492.png)

![3_8](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292226415.png)

**关中断函数：portDISABLE_INTERRUPTS()**

![3_9](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292228607.png)

## 4.临界段代码保护与任务调度器的挂起和恢复

注意只针对FreeRTOS的5~15级中断，0~4级中断仍然响应。（关中断）

![4_1](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292302356.png)

![4_2](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292303356.png)

支持嵌套！！！

![4_3](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311292305371.png)

## 5.列表和列表项

![5_1](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301241020.png)

列表项成员：

xItemValue:列表项的值，用于升序插入；

*pvOwner:列表项的拥有者，用于指向包含列表项的对象，就是任务控制块。

*pvContainer:列表项所在列表，即列表项在哪一个列表；

*pxPrevious:

*pxNext:

![5_8](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301240965.png)

列表成员：

uxNumberOfItems:包含除末尾列表项的其他列表项的总数量；

*pxIndex:用于遍历列表项的指针；

xListEnd:末尾列表项，用于插入新列表，就像先有两只手，才能握住新列表。

![5_2](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301213002.png)

vListInsert是升序插入。

**列表初始化：**

![5_3](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301223240.png)

**列表项初始化：**

![5_4](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301225391.png)

**列表项升序插入：**

![5_5](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301227476.png)

![5_7](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301238378.png)

**列表项末尾插入：是一种无序插入**

![5_6](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301237283.png)

**列表项移除：**

删掉指向你的，你指向的；修改指向你的，你指向的；修改列表项所在列表（NULL）；所属列表列表项总数减1。

![5_10](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301254137.png)

![5_11](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202311301255091.png)