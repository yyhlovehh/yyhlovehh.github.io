## stm32定时器学习笔记

#### 1.Timer定时器

##### 1.1简介

- 定时器可以对输入的时钟进行计数，并在计数值达到设定值时触发中断
- 16位计数器、预分频器、自动重装寄存器的时基单元，在72MHz计数时钟下可以实现最大59.65s的定时
- 不仅具备基本的定时中断功能，而且还包含内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等多种功能
- 根据复杂度和应用场景分为了高级定时器、通用定时器、基本定时器三种类型

定时器的本质就是一个计数器，只不过时钟是固定的，并且加了一个自动重装载计数器。

##### 1.2类型

![定时器类型](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202308211035494.png)

主从触发模式：能让内部的硬件在不受程序的控制下实现自动运行。例如**主模式可以将定时器内部的事件映射到TRGO引脚**。

高级定时器对比通用定时器：

- 有一个重复次数计数器，可以实现每隔几个周期产生更新中断或事件，而通用定时器是每个计数周期都会发生更新，相当于对输出的更新信号做了一次分频。
- 有死区生成电路，之后为一个互补的输出，这些设计是为了驱动三相无刷电机的。死区生成电路是为了防止开关切换输出时由于器件的不理想，出现直通现象，即互补输出开关同时打开。
- 刹车输入，如果外部引脚BKIN或者内部时钟失效产生故障，控制电路自动切断电机的输出，防止意外发生。

#### 2.通用定时器

![通用定时器](https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202308211039498.png)

<div align = "center">通用定时器</div>

主要包含时基单元、输入捕获电路、比较输出电路以及时钟电路。

预分频、计数寄存器实际上有两个寄存器，一个寄存器用于实际控制，一个**缓冲（影子）寄存器**用于更新事件来临时才会将缓冲寄存器的值赋给实际控制的寄存器。计数器预装功能（有影子寄存器）可以被控制。

##### 时钟源：

- 内部时钟CK_INT，一般等于系统时钟SYSCLK
- 外部引脚时钟TIMx_ETR
- ITRx来自其他定时器的TRGO输出，实现定时器的级联
- TIMx_CHx输入的信号，经过滤波器和边沿检测器得到TI1F_ED(ED是指Edge,边沿的意思)，上升沿和下降沿均有效
- TIMx_CHx输入的信号，经过滤波器和边沿检测器得到上升沿信号TI1FP1
- TIMx_CHx输入的信号，经过滤波器和边沿检测器得到下降沿信号TI1FP2

#### 3.输出比较

- 输出比较可以通过比较CNT与CCR寄存器值的关系，来对输出电平进行置1、置0或翻转的操作，用于输出一定频率和占空比的PWM波形
- 每个高级定时器和通用定时器都拥有4个输出比较通道
- 高级定时器的前3个通道额外拥有死区生成和互补输出的功能

##### 3.1PWM简介

- PWM（Pulse Width Modulation）脉冲宽度调制
- 在具有惯性的系统中，可以通过对一系列脉冲的宽度进行调制，来等效地获得所需要的模拟参量，常应用于电机控速等领域
- PWM参数：
       	频率 = 1 / TS            占空比 = TON / TS           分辨率 = 占空比变化步距

![PWM1](C:/Users/杨怡航/Pictures/Microsoft.Windows.Photos_8wekyb3d8bbwe!App/PWM1.png)

<img src="https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202308211234250.png" alt="PWM2" style="zoom: 50%;" />

##### 3.2输出比较通道

##### 3.3输出比较模式

##### 3.4PWM基本结构（江科大）

##### 3.5PWM基本应用

1. PWM驱动舵机

   

2. PWM驱动直流电机