# Stm32ADC学习笔记 

#### 1.ADC简介

- ADC是模拟-数字转换器
- 12位逐次逼近型ADC,1us的转换时间
- 输入电压范围0~3.3V，转换结果位0~4095
- 18个输入通道，可检测16个外部（16个GPIO口）和2个内部信号源（温度传感器、参考电压）
- 规则组和注入组两个转换单元
- 模拟看门狗自动监测输入电压范围

#### 2.预备知识

三态门：可以输出0、1以及高阻态，高阻态相当于虽然电路相连，但实际是断开的，要输出0、1，必须使能。

#### 3.ADC原理图

##### 3.1 ADC0809芯片

<img src="https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202308182302931.png" alt="QQ截图20230818093911" style="zoom:80%;" />

<div align = "center">ADC0809</div>

通过通道选择开关来选择输入信号IN0~IN7，一共八个信号（因此一个ADC可以转换多个信号，不必对每个信号都设计一个ADC）。而通道选择开关由地址锁存和译码模块控制，8个输入信号被编码ADDA、ADDB、AADC三位。当要控制某个通道（对应输入信号INx）打开时，即对该通道的信号进行ADC转换，输入该通道对应的地址（ADDA、ADDB、ADDC）,再给一个锁存信号，使地址锁存器一直输出给定通道的地址，再由编码器编码后打开对应通道的开关。

比较器的两个输入端为待测信号和DAC模拟信号。逐次逼近寄存器SAR输出信号到DAC，DAC将数字信号转为模拟电压，与待测信号INx比较，将比较结果输出到逐次逼近寄存器SAR，SAR会根据比较结果修改存储值，使DAC转换的模拟电压逐渐逼近待测信号的真实电压。将待测模拟信号的ADC转换结果输出给8位三态锁存缓冲器，通过使能信号OE输出D0~D7，完成ADC转换并对外输出。

EOC是转换结束信号，START是开始转换信号，CLOCK是ADC时钟，Vcc、GND供电。

Vref是DAC参考电压，DAC数字信号转为模拟信号，模拟信号的范围为0~Vref，因此ADC模拟信号转为数字信号，转换范围也为0~Vref，大于Vref的模拟电压信号，其转换结果都为Vref(对应2进制全1)，通常Vref=Vcc。

PS:寄存器SAR存储值的逼近过程实际是采用二分法，每次电压比较器的判定结果（1或0）为2进制ADC转换结果对应位的值。

##### 3.2 stm32ADC原理图

<img src="https://raw.githubusercontent.com/yyhlovehh/yyhlovehh.github.io/master/202308182314575.png" alt="QQ截图20230818231319"  />

输入信号有IN0~IN15以及温度传感器、参考电压一共18个信号，其中IN0~IN15对应16个GPIO端口。通过通道选择开关，选择信号输入到模数转换器，转换结果保存到数据寄存器中。

stm32的ADC可以多通道进行ADC转换，并且分为注入通道组和规则通道组，注入通道组最多4通道同时进行ADC转换，将转换结果保存到4个注入通道数据寄存器；而规则通道组最多16个通道同时转换，依次将转换结果保存到规则通道数据寄存器。但由于只有一个规则通道寄存器，后面转换结果会覆盖之前的转换结果，因此需要依靠DMA进行数据转运。

外围电路：

- 左下角触发模式部分（对应ADC0809芯片的START开始转换信号）

​		触发分为软件触发和硬件触发。软件触发就是在程序中写一行代码，开始进行ADC转换。而硬件触发的触发源如图所示，有定时器的通道CHx、定时器主模式输出TRGO、外部中断输入引脚EXTI_x。

- 左上角电源及参考电压部分

- 右边部分

​		ADCCLK是ADC的时钟（对应ADC0809芯片的CLOCK，用于驱动内部逐次比较的时钟），来自ADC的预分频器，而ADC的预分频器信号来自APB2。

​		模拟看门狗设置阈值，如果一旦超过阈值，可以触发中断。

##### 3.3 江科大 stm32ADC原理图



